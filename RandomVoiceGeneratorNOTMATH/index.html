<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Robotic TTS Generator</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:24px;background:#0f172a;color:#e6eef8}
  .card{background:#071028;padding:18px;border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,.6);max-width:900px;margin:auto;}
  textarea{width:100%;height:160px;padding:10px;border-radius:8px;border:1px solid #20314a;background:#061226;color:#dbeeff;resize:vertical}
  .row{display:flex;gap:12px;align-items:center;margin-top:12px;flex-wrap:wrap}
  label{font-size:13px}
  input[type=range]{width:220px}
  select,button,input[type=checkbox]{background:#082235;color:#dbeeff;border:1px solid #11324a;padding:6px;border-radius:8px}
  button{cursor:pointer}
  .controls{display:flex;gap:8px}
  .small{font-size:12px;color:#9fb7cf}
</style>
</head>
<body>
  <div class="card">
    <h2>Robotic Voice Generator (client-side)</h2>
    <p class="small">Uses the browser <code>speechSynthesis</code>. Host on GitHub Pages — no server needed.</p>

    <textarea id="txt">Hello. This is a demo of a robotic voice generator. Edit the text, change pitch and speed, toggle robotic mode, then press Speak.</textarea>

    <div class="row">
      <label>Voice
        <select id="voiceSelect"></select>
      </label>

      <label>Rate <span id="rateVal">1</span>
        <input id="rate" type="range" min="0.3" max="2" step="0.05" value="1">
      </label>

      <label>Pitch <span id="pitchVal">1</span>
        <input id="pitch" type="range" min="0" max="2" step="0.05" value="1">
      </label>

      <label><input id="robotic" type="checkbox"> Robotic mode</label>

      <div class="controls" style="margin-left:auto">
        <button id="speakBtn">Speak</button>
        <button id="stopBtn">Stop</button>
      </div>
    </div>

    <div class="row small" style="margin-top:8px">
      <div>Tip: For more mechanical sound, try a low pitch (0.5) and fast rate (1.2–1.6) and enable Robotic mode.</div>
    </div>
  </div>

<script>
  const synth = window.speechSynthesis;
  const voiceSelect = document.getElementById('voiceSelect');
  const rate = document.getElementById('rate');
  const pitch = document.getElementById('pitch');
  const rateVal = document.getElementById('rateVal');
  const pitchVal = document.getElementById('pitchVal');
  const speakBtn = document.getElementById('speakBtn');
  const stopBtn = document.getElementById('stopBtn');
  const robotic = document.getElementById('robotic');
  const txt = document.getElementById('txt');

  let voices = [];

  function populateVoices(){
    voices = synth.getVoices();
    if (!voices.length) return; // still empty, try later
    voiceSelect.innerHTML = '';
    voices.forEach((v, i) => {
      const opt = document.createElement('option');
      opt.value = i;
      opt.textContent = `${v.name} — ${v.lang}${v.default ? ' (default)' : ''}`;
      if (v.default) opt.selected = true;
      voiceSelect.appendChild(opt);
    });
  }

  populateVoices();
  if (speechSynthesis.onvoiceschanged !== undefined) {
    speechSynthesis.onvoiceschanged = populateVoices;
  }

  rate.addEventListener('input', ()=> rateVal.textContent = rate.value);
  pitch.addEventListener('input', ()=> pitchVal.textContent = pitch.value);

  let speaking = false;

  function speakText(text) {
    if(!text) return;
    if (!voices.length) populateVoices(); // make sure voices are loaded

    const voiceIndex = parseInt(voiceSelect.value) || 0;
    const chosenVoice = voices[voiceIndex] || voices[0] || null;
    const baseRate = parseFloat(rate.value) || 1;
    const basePitch = parseFloat(pitch.value) || 1;
    const isRobotic = robotic.checked;

    if (isRobotic) {
      const words = text.split(/\s+/);
      const chunks = [];
      for(let i=0;i<words.length;i+=2){
        chunks.push(words.slice(i,i+2).join(' '));
      }

      let i = 0;
      speaking = true;
      function playNext(){
        if(!speaking) return;
        if(i >= chunks.length){ speaking = false; return; }
        const u = new SpeechSynthesisUtterance(chunks[i]);
        if (chosenVoice) u.voice = chosenVoice;
        u.pitch = basePitch * (i % 2 === 0 ? 0.85 : 1.15);
        u.rate  = baseRate * (i % 2 === 0 ? 1.15 : 0.9);
        u.onend = () => setTimeout(playNext, 60);
        synth.speak(u);
        i++;
      }
      playNext();
    } else {
      const u = new SpeechSynthesisUtterance(text);
      if (chosenVoice) u.voice = chosenVoice;
      u.rate = baseRate;
      u.pitch = basePitch;
      u.onend = ()=> speaking = false;
      speaking = true;
      synth.speak(u);
    }
  }

  speakBtn.addEventListener('click', ()=>{
    synth.cancel();
    speaking = false;
    setTimeout(()=> speakText(txt.value), 100);
  });

  stopBtn.addEventListener('click', ()=>{
    synth.cancel();
    speaking = false;
  });

  document.addEventListener('keydown', (e)=>{
    if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) speakBtn.click();
  });
</script>
</body>
</html>
